---
title: "DRN_EWAS"
author: "Ehsan Pishva"
date: "3 October 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
##Introduction


###Study Information
**Study:** AD-associated DNA modifications in human brainstem (EPI-AD)

**Description:** Case Control/Braak Stage

**QC done by:** Ehsan Pishva

**Study Contact:** Ehsan Pishva(e.pishva@exeter.ac.uk)

**Samples Source:** London Brain Bank()

**Arrays ran by:** GenomeScan

**Location arrays ran:** Genome Scan

**Array used:** Illumina EPIC microarray v1.0

**Date of QC:** `r format(Sys.Date(), format="%d %B %Y")`

**Sample tissue:** DRN Post-Mortem Brain Tissue

##Loading data


```{r loadingdata, include=FALSE}
rm(list=ls())
library(methylumi)
library(wateRmelon)
require(gdata)
library(minfi)
library(ggplot2)
require(gridExtra)
library(Biobase)
library(MLML2R)
library(sva)
library(qqman)
```

Loading data

```{r loadingdata, include=FALSE}
setwd("/mnt/data1/Ehsan/DRN")
rgSet<-read.metharray.exp(base="/mnt/data1/Ehsan/DRN/IDATS/",extended=TRUE)
save(rgSet, file="rgSet.LC.Rdata")
idatPath<-"/mnt/data1/Ehsan/DRN/IDATS/"
drn.methylumi<-readEPIC(idatPath, barcodes = NULL, oob=F, n=T, parallel=T)
save(drn.methylumi, file="methylumiset.DRN.Rdata")

drn.pfilters<-pfilter(drn.methylumi, perc=5)
cpg.pfiltered.drn<-as.character(rownames(drn.pfilters))
setwd("/mnt/data1/Ehsan/DRN")
save(cpg.pfiltered.drn, file="cpg.pfiltered.lc.Rdata")

DRN_PHENO<-read.csv("pheno.drn.all.csv")
Basename<-substr(DRN_PHENO$sentrix_ID,14,32)
DRN_PHENO<-cbind(DRN_PHENO,Basename)

filtered<-which(DRN_PHENO$Basename=="200772260017_R01C01"|
      DRN_PHENO$Basename=="200772260017_R02C01"|
      DRN_PHENO$Basename=="200793300066_R06C01")

##SAMPLES RECOMMENDED BY GENOMESCAN TO BE DROPPED
filtered.GS<-which(DRN_PHENO$Basename=="200772260017 R01C01"|
      DRN_PHENO$Basename=="200772260017 R02C01"|
      DRN_PHENO$Basename=="200772260017 R04C01"|
      DRN_PHENO$Basename=="200793300066 R06C01")



DRN_PHENO$Sample_Name[filtered]
#[1] 7058-001-BS-065  7058-001-oxBS-065  7058-001-oxBS-043
DRN_PHENO$Basename[which(DRN_PHENO$Sample_Name=="7058-001-BS-043")]
#[1] 200793300066_R05C01

DRN_PHENO.f<-DRN_PHENO[-which(DRN_PHENO$Basename=="200772260017_R01C01"|
      DRN_PHENO$Basename=="200772260017_R02C01"|
      DRN_PHENO$Basename=="200793300066_R06C01"|
      DRN_PHENO$Basename=="200793300066_R05C01"),]
rgSet.f<-rgSet[,-which(DRN_PHENO$Basename=="200772260017_R01C01"|
      DRN_PHENO$Basename=="200772260017_R02C01"|
      DRN_PHENO$Basename=="200793300066_R06C01"|
      DRN_PHENO$Basename=="200793300066_R05C01")]


pheno.bs<-DRN_PHENO.f[which(DRN_PHENO.f$Pool_ID=="BS"),]
pheno.oxbs<-DRN_PHENO.f[which(DRN_PHENO.f$Pool_ID=="oxBS"),]
pheno.bs$id<-substr(pheno.bs$Sample_Name,13,15)
pheno.oxbs$id<-substr(pheno.oxbs$Sample_Name,15,17)

identical(pheno.bs$id,pheno.oxbs$id)

BS<-as.character(pheno.bs$Basename)
oxBS<-as.character(pheno.oxbs$Basename)


RGset.BS<-rgSet[,BS]
RGset.oxBS<-rgSet[,oxBS]

identical(colnames(RGset.BS), BS)
identical(colnames(RGset.oxBS), oxBS)

rm(rgSet,DRN_PHENO,DRN_PHENO.1)
setwd("/mnt/data1/Ehsan/DRN")
save(RGset.BS, RGset.oxBS, pheno.bs, pheno.oxbs, file="DRN_RGsets_phenos.Rdata")



```

##QC

```{r QC, echo=FALSE}
MSet.BS<-preprocessRaw(RGset.BS)
MSet.oxBS<-preprocessRaw(RGset.oxBS)

par(mfrow=c(1,2))
plotQC(getQC(MSet.BS))
plotQC(getQC(MSet.oxBS))

par(mfrow=c(1,2))
densityPlot(MSet.BS, main="BS")
densityPlot(MSet.oxBS, main="oxBS")
```

Extarct and plot the intensities of the red/green backgroaund and modification signals

```{r raw intensities,echo=FALSE}
##BS
con.red<-getRed(RGset.BS)[getProbeInfo(RGset.BS, type = "Control")$Address,]
rownames(con.red)<-getProbeInfo(RGset.BS, type = "Control")$ExtendedType
con.green<-getGreen(RGset.BS)[getProbeInfo(RGset.BS, type = "Control")$Address,]
rownames(con.green)<-getProbeInfo(RGset.BS, type = "Control")$ExtendedType

neg.red.bs<-con.red[which(getProbeInfo(RGset.BS, type = "Control")$Type == "NEGATIVE"),]
neg.green.bs<-con.green[which(getProbeInfo(RGset.BS, type = "Control")$Type == "NEGATIVE"),]

neg.red.mean.bs.drn<-colMeans(neg.red.bs)
neg.green.mean.bs.drn<-colMeans(neg.green.bs)
green.mean.bs.drn<-colMeans(getGreen(RGset.BS))
red.mean.bs.drn<-colMeans(getRed(RGset.BS))

##OXBS
con.red<-getRed(RGset.oxBS)[getProbeInfo(RGset.oxBS, type = "Control")$Address,]
rownames(con.red)<-getProbeInfo(RGset.oxBS, type = "Control")$ExtendedType
con.green<-getGreen(RGset.oxBS)[getProbeInfo(RGset.oxBS, type = "Control")$Address,]
rownames(con.green)<-getProbeInfo(RGset.oxBS, type = "Control")$ExtendedType


neg.red.oxbs<-con.red[which(getProbeInfo(RGset.oxBS, type = "Control")$Type == "NEGATIVE"),]
neg.green.oxbs<-con.green[which(getProbeInfo(RGset.oxBS, type = "Control")$Type == "NEGATIVE"),]

neg.red.mean.oxbs.drn<-colMeans(neg.red.oxbs)
neg.green.mean.oxbs.drn<-colMeans(neg.green.oxbs)
green.mean.oxbs.drn<-colMeans(getGreen(RGset.oxBS))
red.mean.oxbs.drn<-colMeans(getRed(RGset.oxBS))


par(mfrow=c(1,4))
plot(neg.red.mean.bs.drn, xlab = "Sample", ylab = "Background Intensity", col="red", pch = 16, ylim = c(0, 5000))
par(new=TRUE)
plot(neg.green.mean.bs.drn, xlab = "Sample", ylab = "", col="Green", pch = 16, ylim = c(0, 5000))

plot(red.mean.bs.drn, xlab = "Sample", ylab = "Detected Intensity", col="red", pch = 16, ylim = c(0, 5000))
par(new=TRUE)
plot(green.mean.bs.drn, xlab = "Sample", ylab = "", col="Green", pch = 16, ylim = c(0, 5000))

plot(neg.red.mean.oxbs.drn, xlab = "Sample", ylab = "Background Intensity", col="red", pch = 16, ylim = c(0, 5000))
par(new=TRUE)
plot(neg.green.mean.oxbs.drn, xlab = "Sample", ylab = "", col="Green", pch = 16, ylim = c(0, 5000))

plot(red.mean.oxbs.drn, xlab = "Sample", ylab = "Detected Intensity", col="red", pch = 16, ylim = c(0, 5000))
par(new=TRUE)
plot(green.mean.oxbs.drn, xlab = "Sample", ylab = "", col="Green", pch = 16, ylim = c(0, 5000))


rm(con.red,con.green,neg.red.bs,neg.green.bs,neg.red.mean.bs.drn,neg.green.mean.bs.drn,green.mean.bs.drn,red.mean.bs.drn,
   neg.red.oxbs,neg.green.oxbs,neg.red.mean.oxbs.drn,neg.green.mean.oxbs.drn,green.mean.oxbs.drn,red.mean.oxbs.drn)

```

##Normalisation(Noob)
Applying R/G ratio flip to fix dye bias

```{r NoobNormalisation, include=FALSE}
MSet.Noob.bs.drn  <-preprocessNoob(RGset.BS)
MSet.Noob.oxbs.drn<-preprocessNoob(RGset.oxBS)
```

##Plot the Normalised data

```{r NoobNormalisationQCplotting, echo=FALSE}
par(mfrow=c(1,2))
plotQC(getQC(MSet.Noob.bs.drn))
plotQC(getQC(MSet.Noob.oxbs.drn))
```

Check if the colnames of BS and oxBS are matched

```{r colnamesmatching, include=FALSE}
pheno.bs$id<-substr(pheno.bs$Sample_Name,13,15)
pheno.oxbs$id<-substr(pheno.oxbs$Sample_Name,15,17)
colnames(MSet.Noob.bs.drn)<-pheno.bs$id
colnames(MSet.Noob.oxbs.drn)<-pheno.oxbs$id
print(identical(colnames(MSet.Noob.bs.drn),colnames(MSet.Noob.oxbs.drn)))
```

Extracting Methylated Unmethylated values from BS & oxBS

```{r meth_unmeth extraction, include=FALSE}
methBS      <- getMeth(MSet.Noob.bs.drn)
methOxBS    <- getMeth(MSet.Noob.oxbs.drn)
unmethBS    <- getUnmeth(MSet.Noob.bs.drn)
unmethOxBS  <- getUnmeth(MSet.Noob.oxbs.drn)
```

Plot the signal intensities after normalisation

```{r PlotNoobNormalisation, echo=FALSE}
par(mfrow=c(1,2))
plot(colMeans(methBS), xlab = "Sample", ylab = "Signal Intensity", col="green", pch = 16, ylim = c(0, 7000))
par(new=TRUE)
plot(colMeans(unmethBS), xlab = "Sample", ylab = "Signal Intensity", col="red", pch = 16, ylim = c(0, 7000))

plot(colMeans(methOxBS), xlab = "Sample", ylab = "Signal Intensity", col="green", pch = 16, ylim = c(0, 7000))
par(new=TRUE)
plot(colMeans(unmethOxBS), xlab = "Sample", ylab = "Signal Intensity", col="red", pch = 16, ylim = c(0, 7000))
```

Getting beta values and subtracting oxBS from BS 
if the conames of normalised betas is matched for BS and oxBS data

```{r GettingBetas, include=FALSE}
betas.Noob.bs.drn    <-getBeta(MSet.Noob.bs.drn)
betas.Noob.oxbs.drn  <-getBeta(MSet.Noob.oxbs.drn)
betas.raw.bs.drn     <-getBeta(MSet.BS)
betas.raw.oxbs.drn   <-getBeta(MSet.oxBS)

print(identical(colnames(betas.Noob.bs.drn),colnames(betas.Noob.oxbs.drn)))

mydf<-betas.Noob.bs.drn-betas.Noob.oxbs.drn
```

Plotting the BS-oxBS and beta density plots before and after normalisation

```{r NoobNormalisationPLOTS, echo=FALSE}
plot(density(mydf), main="BS-oxBS")
abline(v=0, col="red", lty=1, lwd=1)
par(mfrow=c(1,2))

plot(density(na.omit(betas.raw.bs.drn)), col="royalblue3", ylim=c(0,7), main="Raw",lwd=2, xlab="")
par(new=TRUE)
plot(density(na.omit(betas.raw.oxbs.drn)), col="red4", ylim=c(0,7), main="Raw",lwd=2, xlab="")

plot(density(na.omit(betas.Noob.bs.drn)), col="royalblue3", ylim=c(0,7), main="Internal Control",lwd=2, xlab="")
par(new=TRUE)
plot(density(na.omit(betas.Noob.oxbs.drn)), col="red4", ylim=c(0,7), main="Internal Control",lwd=2, xlab="")
```




```{r plotting BS-oxBS in percentile BS and oxBS beta value bins ,echo=FALSE}
I.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)<=0.01),])
II.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.01 & rowMeans(betas.Noob.oxbs.drn)<=0.02),])
III.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.02 & rowMeans(betas.Noob.oxbs.drn)<=0.03),])
IV.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.03 & rowMeans(betas.Noob.oxbs.drn)<=0.04),])
V.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.04 & rowMeans(betas.Noob.oxbs.drn)<=0.05),])
VI.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.bs.drn)>0.05 & rowMeans(betas.Noob.bs.drn)<=0.06),])
VII.1<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.06 & rowMeans(betas.Noob.bs.drn)<=0.07),])
VIII.1<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.07 & rowMeans(betas.Noob.bs.drn)<=0.08),])
IX.1<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.08 & rowMeans(betas.Noob.bs.drn)<=0.09),])
X.1<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.09 & rowMeans(betas.Noob.bs.drn)<=0.1),])

I.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.10 & rowMeans(betas.Noob.bs.drn)<=0.11),])
II.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.11 & rowMeans(betas.Noob.bs.drn)<=0.12),])
III.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.12 & rowMeans(betas.Noob.bs.drn)<=0.13),])
IV.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.13 & rowMeans(betas.Noob.bs.drn)<=0.14),])
V.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.14 & rowMeans(betas.Noob.bs.drn)<=0.15),])
VI.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.15 & rowMeans(betas.Noob.bs.drn)<=0.16),])
VII.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.16 & rowMeans(betas.Noob.bs.drn)<=0.17),])
VIII.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.17 & rowMeans(betas.Noob.bs.drn)<=0.18),])
IX.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.18 & rowMeans(betas.Noob.bs.drn)<=0.19),])
X.2<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.19 & rowMeans(betas.Noob.bs.drn)<=0.20),])

I.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.20 & rowMeans(betas.Noob.bs.drn)<=0.21),])
II.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.21 & rowMeans(betas.Noob.bs.drn)<=0.22),])
III.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.22 & rowMeans(betas.Noob.bs.drn)<=0.23),])
IV.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.23 & rowMeans(betas.Noob.bs.drn)<=0.24),])
V.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.24 & rowMeans(betas.Noob.bs.drn)<=0.25),])
VI.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.25 & rowMeans(betas.Noob.bs.drn)<=0.26),])
VII.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.26 & rowMeans(betas.Noob.bs.drn)<=0.27),])
VIII.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.27 & rowMeans(betas.Noob.bs.drn)<=0.28),])
IX.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.28 & rowMeans(betas.Noob.bs.drn)<=0.29),])
X.3<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.29 & rowMeans(betas.Noob.bs.drn)<=0.30),])

I.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.30 & rowMeans(betas.Noob.bs.drn)<=0.31),])
II.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.31 & rowMeans(betas.Noob.bs.drn)<=0.32),])
III.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.32 & rowMeans(betas.Noob.bs.drn)<=0.33),])
IV.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.33 & rowMeans(betas.Noob.bs.drn)<=0.34),])
V.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.34 & rowMeans(betas.Noob.bs.drn)<=0.35),])
VI.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.35 & rowMeans(betas.Noob.bs.drn)<=0.36),])
VII.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.36 & rowMeans(betas.Noob.bs.drn)<=0.37),])
VIII.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.37 & rowMeans(betas.Noob.bs.drn)<=0.38),])
IX.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.38 & rowMeans(betas.Noob.bs.drn)<=0.39),])
X.4<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.39 & rowMeans(betas.Noob.bs.drn)<=0.40),])

I.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.40 & rowMeans(betas.Noob.bs.drn)<=0.41),])
II.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.41 & rowMeans(betas.Noob.bs.drn)<=0.42),])
III.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.42 & rowMeans(betas.Noob.bs.drn)<=0.43),])
IV.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.43 & rowMeans(betas.Noob.bs.drn)<=0.44),])
V.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.44 & rowMeans(betas.Noob.bs.drn)<=0.45),])
VI.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.45 & rowMeans(betas.Noob.bs.drn)<=0.46),])
VII.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.46 & rowMeans(betas.Noob.bs.drn)<=0.47),])
VIII.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.47 & rowMeans(betas.Noob.bs.drn)<=0.48),])
IX.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.48 & rowMeans(betas.Noob.bs.drn)<=0.49),])
X.5<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.49 & rowMeans(betas.Noob.bs.drn)<=0.50),])

I.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.50 & rowMeans(betas.Noob.bs.drn)<=0.51),])
II.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.51 & rowMeans(betas.Noob.bs.drn)<=0.52),])
III.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.52 & rowMeans(betas.Noob.bs.drn)<=0.53),])
IV.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.53 & rowMeans(betas.Noob.bs.drn)<=0.54),])
V.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.54 & rowMeans(betas.Noob.bs.drn)<=0.55),])
VI.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.55 & rowMeans(betas.Noob.bs.drn)<=0.56),])
VII.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.56 & rowMeans(betas.Noob.bs.drn)<=0.57),])
VIII.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.57 & rowMeans(betas.Noob.bs.drn)<=0.58),])
IX.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.58 & rowMeans(betas.Noob.bs.drn)<=0.59),])
X.6<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.59 & rowMeans(betas.Noob.bs.drn)<=0.60),])

I.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.60 & rowMeans(betas.Noob.bs.drn)<=0.61),])
II.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.61 & rowMeans(betas.Noob.bs.drn)<=0.62),])
III.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.62 & rowMeans(betas.Noob.bs.drn)<=0.63),])
IV.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.63 & rowMeans(betas.Noob.bs.drn)<=0.64),])
V.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.64 & rowMeans(betas.Noob.bs.drn)<=0.65),])
VI.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.65 & rowMeans(betas.Noob.bs.drn)<=0.66),])
VII.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.66 & rowMeans(betas.Noob.bs.drn)<=0.67),])
VIII.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.67 & rowMeans(betas.Noob.bs.drn)<=0.68),])
IX.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.68 & rowMeans(betas.Noob.bs.drn)<=0.69),])
X.7<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.69 & rowMeans(betas.Noob.bs.drn)<=0.70),])

I.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.70 & rowMeans(betas.Noob.bs.drn)<=0.71),])
II.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.71 & rowMeans(betas.Noob.bs.drn)<=0.72),])
III.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.72 & rowMeans(betas.Noob.bs.drn)<=0.73),])
IV.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.73 & rowMeans(betas.Noob.bs.drn)<=0.74),])
V.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.74 & rowMeans(betas.Noob.bs.drn)<=0.75),])
VI.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.75 & rowMeans(betas.Noob.bs.drn)<=0.76),])
VII.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.76 & rowMeans(betas.Noob.bs.drn)<=0.77),])
VIII.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.77 & rowMeans(betas.Noob.bs.drn)<=0.78),])
IX.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.78 & rowMeans(betas.Noob.bs.drn)<=0.79),])
X.8<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.79 & rowMeans(betas.Noob.bs.drn)<=0.80),])

I.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.80 & rowMeans(betas.Noob.bs.drn)<=0.81),])
II.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.81 & rowMeans(betas.Noob.bs.drn)<=0.82),])
III.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.82 & rowMeans(betas.Noob.bs.drn)<=0.83),])
IV.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.83 & rowMeans(betas.Noob.bs.drn)<=0.84),])
V.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.84 & rowMeans(betas.Noob.bs.drn)<=0.85),])
VI.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.85 & rowMeans(betas.Noob.bs.drn)<=0.86),])
VII.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.86 & rowMeans(betas.Noob.bs.drn)<=0.87),])
VIII.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.87 & rowMeans(betas.Noob.bs.drn)<=0.88),])
IX.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.88 & rowMeans(betas.Noob.bs.drn)<=0.89),])
X.9<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.89 & rowMeans(betas.Noob.bs.drn)<=0.90),])

I.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.90 & rowMeans(betas.Noob.bs.drn)<=91),])
II.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.91 & rowMeans(betas.Noob.bs.drn)<=0.92),])
III.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.92 & rowMeans(betas.Noob.bs.drn)<=0.93),])
IV.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.93 & rowMeans(betas.Noob.bs.drn)<=0.94),])
V.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.94 & rowMeans(betas.Noob.bs.drn)<=0.95),])
VI.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.95 & rowMeans(betas.Noob.bs.drn)<=0.96),])
VII.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.96 & rowMeans(betas.Noob.bs.drn)<=0.97),])
VIII.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.97 & rowMeans(betas.Noob.bs.drn)<=0.98),])
IX.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.98 & rowMeans(betas.Noob.bs.drn)<=0.99),])
X.10<-rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)>0.99 & rowMeans(betas.Noob.bs.drn)<=1),])

par(mfrow=c(1,2))
boxplot(rowMeans(mydf[which(rownames(mydf) %in% I.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.1),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.2),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.3),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.4),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.5),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.6),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.7),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.8),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% I.9),]),
        
        rowMeans(mydf[which(rownames(mydf) %in% II.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.10),]))
abline(h=0, col="red", lty=1, lwd=1)


I.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)<=0.01),])
II.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.01 & rowMeans(betas.Noob.oxbs.drn)<=0.02),])
III.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.02 & rowMeans(betas.Noob.oxbs.drn)<=0.03),])
IV.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.03 & rowMeans(betas.Noob.oxbs.drn)<=0.04),])
V.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.04 & rowMeans(betas.Noob.oxbs.drn)<=0.05),])
VI.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.05 & rowMeans(betas.Noob.oxbs.drn)<=0.06),])
VII.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.06 & rowMeans(betas.Noob.oxbs.drn)<=0.07),])
VIII.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.07 & rowMeans(betas.Noob.oxbs.drn)<=0.08),])
IX.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.08 & rowMeans(betas.Noob.oxbs.drn)<=0.09),])
X.1<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.09 & rowMeans(betas.Noob.oxbs.drn)<=0.1),])

I.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.10 & rowMeans(betas.Noob.oxbs.drn)<=0.11),])
II.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.11 & rowMeans(betas.Noob.oxbs.drn)<=0.12),])
III.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.12 & rowMeans(betas.Noob.oxbs.drn)<=0.13),])
IV.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.13 & rowMeans(betas.Noob.oxbs.drn)<=0.14),])
V.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.14 & rowMeans(betas.Noob.oxbs.drn)<=0.15),])
VI.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.15 & rowMeans(betas.Noob.oxbs.drn)<=0.16),])
VII.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.16 & rowMeans(betas.Noob.oxbs.drn)<=0.17),])
VIII.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.17 & rowMeans(betas.Noob.oxbs.drn)<=0.18),])
IX.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.18 & rowMeans(betas.Noob.oxbs.drn)<=0.19),])
X.2<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.19 & rowMeans(betas.Noob.oxbs.drn)<=0.20),])

I.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.20 & rowMeans(betas.Noob.oxbs.drn)<=0.21),])
II.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.21 & rowMeans(betas.Noob.oxbs.drn)<=0.22),])
III.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.22 & rowMeans(betas.Noob.oxbs.drn)<=0.23),])
IV.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.23 & rowMeans(betas.Noob.oxbs.drn)<=0.24),])
V.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.24 & rowMeans(betas.Noob.oxbs.drn)<=0.25),])
VI.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.25 & rowMeans(betas.Noob.oxbs.drn)<=0.26),])
VII.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.26 & rowMeans(betas.Noob.oxbs.drn)<=0.27),])
VIII.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.27 & rowMeans(betas.Noob.oxbs.drn)<=0.28),])
IX.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.28 & rowMeans(betas.Noob.oxbs.drn)<=0.29),])
X.3<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.29 & rowMeans(betas.Noob.oxbs.drn)<=0.30),])

I.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.30 & rowMeans(betas.Noob.oxbs.drn)<=0.31),])
II.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.31 & rowMeans(betas.Noob.oxbs.drn)<=0.32),])
III.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.32 & rowMeans(betas.Noob.oxbs.drn)<=0.33),])
IV.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.33 & rowMeans(betas.Noob.oxbs.drn)<=0.34),])
V.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.34 & rowMeans(betas.Noob.oxbs.drn)<=0.35),])
VI.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.35 & rowMeans(betas.Noob.oxbs.drn)<=0.36),])
VII.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.36 & rowMeans(betas.Noob.oxbs.drn)<=0.37),])
VIII.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.37 & rowMeans(betas.Noob.oxbs.drn)<=0.38),])
IX.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.38 & rowMeans(betas.Noob.oxbs.drn)<=0.39),])
X.4<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.39 & rowMeans(betas.Noob.oxbs.drn)<=0.40),])

I.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.40 & rowMeans(betas.Noob.oxbs.drn)<=0.41),])
II.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.41 & rowMeans(betas.Noob.oxbs.drn)<=0.42),])
III.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.42 & rowMeans(betas.Noob.oxbs.drn)<=0.43),])
IV.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.43 & rowMeans(betas.Noob.oxbs.drn)<=0.44),])
V.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.44 & rowMeans(betas.Noob.oxbs.drn)<=0.45),])
VI.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.45 & rowMeans(betas.Noob.oxbs.drn)<=0.46),])
VII.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.46 & rowMeans(betas.Noob.oxbs.drn)<=0.47),])
VIII.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.47 & rowMeans(betas.Noob.oxbs.drn)<=0.48),])
IX.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.48 & rowMeans(betas.Noob.oxbs.drn)<=0.49),])
X.5<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.49 & rowMeans(betas.Noob.oxbs.drn)<=0.50),])

I.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.50 & rowMeans(betas.Noob.oxbs.drn)<=0.51),])
II.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.51 & rowMeans(betas.Noob.oxbs.drn)<=0.52),])
III.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.52 & rowMeans(betas.Noob.oxbs.drn)<=0.53),])
IV.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.53 & rowMeans(betas.Noob.oxbs.drn)<=0.54),])
V.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.54 & rowMeans(betas.Noob.oxbs.drn)<=0.55),])
VI.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.55 & rowMeans(betas.Noob.oxbs.drn)<=0.56),])
VII.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.56 & rowMeans(betas.Noob.oxbs.drn)<=0.57),])
VIII.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.57 & rowMeans(betas.Noob.oxbs.drn)<=0.58),])
IX.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.58 & rowMeans(betas.Noob.oxbs.drn)<=0.59),])
X.6<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.59 & rowMeans(betas.Noob.oxbs.drn)<=0.60),])

I.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.60 & rowMeans(betas.Noob.oxbs.drn)<=0.61),])
II.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.61 & rowMeans(betas.Noob.oxbs.drn)<=0.62),])
III.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.62 & rowMeans(betas.Noob.oxbs.drn)<=0.63),])
IV.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.63 & rowMeans(betas.Noob.oxbs.drn)<=0.64),])
V.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.64 & rowMeans(betas.Noob.oxbs.drn)<=0.65),])
VI.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.65 & rowMeans(betas.Noob.oxbs.drn)<=0.66),])
VII.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.66 & rowMeans(betas.Noob.oxbs.drn)<=0.67),])
VIII.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.67 & rowMeans(betas.Noob.oxbs.drn)<=0.68),])
IX.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.68 & rowMeans(betas.Noob.oxbs.drn)<=0.69),])
X.7<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.69 & rowMeans(betas.Noob.oxbs.drn)<=0.70),])

I.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.70 & rowMeans(betas.Noob.oxbs.drn)<=0.71),])
II.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.71 & rowMeans(betas.Noob.oxbs.drn)<=0.72),])
III.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.72 & rowMeans(betas.Noob.oxbs.drn)<=0.73),])
IV.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.73 & rowMeans(betas.Noob.oxbs.drn)<=0.74),])
V.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.74 & rowMeans(betas.Noob.oxbs.drn)<=0.75),])
VI.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.75 & rowMeans(betas.Noob.oxbs.drn)<=0.76),])
VII.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.76 & rowMeans(betas.Noob.oxbs.drn)<=0.77),])
VIII.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.77 & rowMeans(betas.Noob.oxbs.drn)<=0.78),])
IX.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.78 & rowMeans(betas.Noob.oxbs.drn)<=0.79),])
X.8<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.79 & rowMeans(betas.Noob.oxbs.drn)<=0.80),])

I.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.80 & rowMeans(betas.Noob.oxbs.drn)<=0.81),])
II.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.81 & rowMeans(betas.Noob.oxbs.drn)<=0.82),])
III.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.82 & rowMeans(betas.Noob.oxbs.drn)<=0.83),])
IV.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.83 & rowMeans(betas.Noob.oxbs.drn)<=0.84),])
V.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.84 & rowMeans(betas.Noob.oxbs.drn)<=0.85),])
VI.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.85 & rowMeans(betas.Noob.oxbs.drn)<=0.86),])
VII.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.86 & rowMeans(betas.Noob.oxbs.drn)<=0.87),])
VIII.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.87 & rowMeans(betas.Noob.oxbs.drn)<=0.88),])
IX.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.88 & rowMeans(betas.Noob.oxbs.drn)<=0.89),])
X.9<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.89 & rowMeans(betas.Noob.oxbs.drn)<=0.90),])

I.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.90 & rowMeans(betas.Noob.oxbs.drn)<=91),])
II.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.91 & rowMeans(betas.Noob.oxbs.drn)<=0.92),])
III.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.92 & rowMeans(betas.Noob.oxbs.drn)<=0.93),])
IV.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.93 & rowMeans(betas.Noob.oxbs.drn)<=0.94),])
V.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.94 & rowMeans(betas.Noob.oxbs.drn)<=0.95),])
VI.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.95 & rowMeans(betas.Noob.oxbs.drn)<=0.96),])
VII.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.96 & rowMeans(betas.Noob.oxbs.drn)<=0.97),])
VIII.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.97 & rowMeans(betas.Noob.oxbs.drn)<=0.98),])
IX.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.98 & rowMeans(betas.Noob.oxbs.drn)<=0.99),])
X.10<-rownames(betas.Noob.oxbs.drn[which(rowMeans(betas.Noob.oxbs.drn)>0.99 & rowMeans(betas.Noob.oxbs.drn)<=1),])


boxplot(rowMeans(mydf[which(rownames(mydf) %in% I.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.1),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.1),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.2),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.2),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.3),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.3),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.4),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.4),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.5),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.5),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.6),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.6),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.7),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.7),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.8),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.8),]),
        
        
        rowMeans(mydf[which(rownames(mydf) %in% I.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% II.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.9),]),
        rowMeans(mydf[which(rownames(mydf) %in% I.9),]),
        
        rowMeans(mydf[which(rownames(mydf) %in% II.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% III.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% IV.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% V.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% VI.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% VII.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% VIII.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% IX.10),]),
        rowMeans(mydf[which(rownames(mydf) %in% X.10),]))

abline(h=0, col="red", lty=1, lwd=1)
```


##Maximum likliehood estomation of states of cytosine


```{r ML method, include=FALSE}
results_exact <-MLML(T.matrix = methBS , U.matrix = unmethBS, L.matrix = unmethOxBS, M.matrix = methOxBS)

U<-data.frame(results_exact$C)
mC<-data.frame(results_exact$mC)
hmC<-data.frame(results_exact$hmC)

hmC.f<-hmC[rownames(betas.Noob.bs.drn[which(rowMeans(betas.Noob.bs.drn)> 0.1),]),]

a<-data.frame(apply(hmC.f, 1, function(x) sum(x==0)))
a<-which(a[,1]< .5*ncol(hmC.f))
length(a)#[1] 806673
cpg.hmc<-hmC.f[a,]
cpg.hmc<-rownames(hmC.f[a,])

betas<-betas.Noob.bs.drn
save(U, mC, hmC, betas, pheno.bs, cpg.hmc, cpg.pfiltered, file="DRN_ML_ReadyforEWAS.Rdata" )
```


```{r MLPLOTS method, echo =FALSE}
par(mfrow=c(1,3))
plot(density(as.matrix(U)),main="C",ylim=c(0,10))
plot(density(as.matrix(mC)), main="mC",ylim=c(0,10))
plot(density(as.matrix(hmC[cpg.hmc,])), main="hmC",ylim=c(0,10))
```










































```{r performin sva, include=FALSE}
mydf<-na.omit(U.f)
sva.U<- sva(dat = as.matrix(mydf), mod = design, mod0 = design[ ,-2])
mydf<-na.omit(mC.f)
sva.mC<- sva(dat = as.matrix(mydf), mod = design, mod0 = design[ , -2])
hmC.f.f<-hmC.f[which(rownames(hmC.f)%in% cpg.hmc),]
mydf<-na.omit(hmC.f[b,])
sva.hmC<- sva(dat = as.matrix(mydf), mod = design, mod0 = design[ , -2])
save(sva.U, sva.mC, sva.hmC, file="sva.drn.83.Rdata")
```


```{r EWAS formula, include=TRUE}
 EWAS <- function(x, BraakStage, Ageatdeath, Gender, Chipid,  sv1 , sv2 , sv3, sv4,sv5){
	fit<-lm(BraakStage ~ as.numeric(x) + Ageatdeath + Gender + Chipid + sv1 + sv2 + sv3 + sv4 +sv5)
	return(cbind(coef(summary(fit))[2,], shapiro.test(fit$residuals)$p.value))
} 
```


```{r converting the vars to the correct vectors, include=FALSE}
setwd("/mnt/data1/Ehsan/DRN/")
load("sva.drn.83.Rdata")

pheno$BraakStage<-as.numeric(pheno$BraakStage)
pheno$Gender<-as.factor(pheno$Gender)
pheno$Ageatdeath<-as.numeric(pheno$Ageatdeath)
Chipid<-as.factor(substr((pheno$sentrix_ID),1,12))
BraakStage<-pheno$BraakStage
Ageatdeath<-pheno$Ageatdeath
Gender<-pheno$Gender

```

```{r EWAS.Unmodified , include=FALSE}
sv1<-sva.U$sv[,1]
sv2<-sva.U$sv[,2]
sv3<-sva.U$sv[,3]
sv4<-sva.U$sv[,4]
sv5<-sva.U$sv[,5]

cl<- makeCluster(32)
res.U<-t(parApply(cl, U.f , 1, EWAS, BraakStage, Ageatdeath, Gender , Chipid, sv1 ,sv2 ,sv3, sv4, sv5))

res.U<-res.U[,c(1:5)]
p.BH.U<-as.data.frame(p.adjust(res.U[,4], "BH"))
res.U<-cbind(res.U,p.BH.U)
colnames(res.U)<-c("U.Estimate","U.SE","U.t","U.P","resid.norm.U","BH.U")
head(res.U)
```

```{r EWAS formula, include=TRUE}
 EWAS <- function(x, BraakStage, Ageatdeath, Gender, Chipid,  sv1 , sv2 , sv3){
	fit<-lm(BraakStage ~ as.numeric(x) + Ageatdeath + Gender + Chipid + sv1 + sv2 + sv3 )
	return(cbind(coef(summary(fit))[2,], shapiro.test(fit$residuals)$p.value))
} 
```


```{r EWAS.mC , include=FALSE}
sv1<-sva.mC$sv[,1]
sv2<-sva.mC$sv[,2]
sv3<-sva.mC$sv[,3]
sv4<-sva.mC$sv[,4]
sv5<-sva.mC$sv[,5]
cl<- makeCluster(64)
res.mC<-t(parApply(cl, mC.f , 1, EWAS, BraakStage, Ageatdeath, Gender , Chipid, sv1 ,sv2 ,sv3))

res.mC<-res.mC[,c(1:5)]
p.BH.mC<-as.data.frame(p.adjust(res.mC[,4], "BH"))
res.mC<-cbind(res.mC,p.BH.mC)
colnames(res.mC)<-c("mC.Estimate","mC.SE","mC.t","mC.P","resid.norm.mC","BH.mC")

#```


#```{r EWAS.hmC , include=FALSE}
sv1<-sva.hmC$sv[,1]
sv2<-sva.hmC$sv[,2]
sv3<-sva.hmC$sv[,3]
sv4<-sva.hmC$sv[,4]
sv5<-sva.hmC$sv[,5]

res.hmC<-t(parApply(cl, hmC.f , 1, EWAS, BraakStage, Ageatdeath, Gender , Chipid, sv1 ,sv2 ,sv3))
res.hmC<-res.hmC[,c(1:5)]
colnames(res.hmC)<-c("hmC.Estimate","hmC.SE","hmC.t","hmC.P","resid.norm.hmC")
stopCluster(cl)
#```


#```{r Lambda , include=FALSE}
REULTS.DRN<-cbind(res.hmC,res.mC,res.U)
dim(REULTS.DRN)
#REMOVE CROSS-HYBRIDISING PROBES
cross<-read.table("/mnt/data1/EPIC_reference/CrossHydridisingProbes_McCartney.txt", stringsAsFactors = FALSE)
crosslist<-cross[,1]
length(crosslist)
#[1]44210  
REULTS.DRN.1 <-REULTS.DRN[ !rownames(REULTS.DRN) %in% crosslist,]
dim(REULTS.DRN.1)
##REMOVE PROBES with SNPs
snpProbes<-read.table("/mnt/data1/EPIC_reference/SNPProbes_McCartney.txt", stringsAsFactors = FALSE, header = TRUE)
dim(snpProbes)
#[1] 340327     18
snpProbes<-snpProbes[which(snpProbes$EUR_AF >= 0.05 & snpProbes$EUR_AF <= 0.95),]
dim(snpProbes)
# [1] 10888    18
SNPlist<-snpProbes[,1]
REULTS.DRN.2 <- REULTS.DRN.1[ ! rownames(REULTS.DRN.1) %in% SNPlist,]

##REMOVE bad probes
badProbes<-read.csv("/mnt/data1/EPIC_reference/EPICArrayProbesToFilter.csv", stringsAsFactors = FALSE, header = TRUE)
dim(badProbes)
#[1] 977  48
badlist<-badProbes[,1]
REULTS.DRN.3 <- REULTS.DRN.2[ ! rownames(REULTS.DRN.2) %in% badlist,]
dim(REULTS.DRN.1) # 
dim(REULTS.DRN.2) # 
dim(REULTS.DRN.3) # 

#epicManifest<-read.csv("/mnt/data1/EPIC_reference/MethylationEPIC_v-1-0_B4.csv", skip = 7)
ANNOT<-data.frame(epicManifest)
###### QC 5.  Remove Chr X Y ########
sexchrX<-ANNOT[which(ANNOT$CHR=="X"),]
dim(sexchrX) #[1] 19120    48
sexchrY<- ANNOT[which(ANNOT$CHR== "Y"),]
dim(sexchrY) #[1] 561  48

REULTS.DRN.4 <- REULTS.DRN.3[!(rownames(REULTS.DRN.3) %in% sexchrX$IlmnID),]
REULTS.DRN.5 <- REULTS.DRN.4[!(rownames(REULTS.DRN.4) %in% sexchrY$IlmnID),]

ANNOT.sub<-ANNOT[which(ANNOT$Name%in% rownames(REULTS.DRN.5)),]


ANNOT.sub<-ANNOT.sub[order(ANNOT.sub$Name),]
REULTS.DRN.5<-REULTS.DRN.5[order(rownames(REULTS.DRN.5)),]

identical(as.character(rownames(REULTS.DRN.5)), as.character(ANNOT.sub$Name))

DRN.RESULTS.ANNOT<-cbind(REULTS.DRN.5,ANNOT.sub)
head(DRN.RESULTS.ANNOT)
table(DRN.RESULTS.ANNOT$CHR)
save(DRN.RESULTS.ANNOT, file="DRN.RESULTS.ANNOT.Rdata")
DRN.RESULTS.ANNOT10<-DRN.RESULTS.ANNOT[which(DRN.RESULTS.ANNOT$Name%in%rownames(mydf)),]


col<-c("hmC.Estimate","hmC.SE","hmC.t","hmC.P","mC.Estimate","mC.SE","mC.t","mC.P","U.Estimate","U.SE","U.t","U.P","CHR","MAPINFO","UCSC_RefGene_Name","UCSC_RefGene_Group","Relation_to_UCSC_CpG_Island","Regulatory_Feature_Group")
hmC.p.ranked<-DRN.RESULTS.ANNOT10[order(DRN.RESULTS.ANNOT10[,4]),]
write.csv(hmC.p.ranked[1:100,col], file="top100.hmC.DRN.csv")


col<-c("hmC.Estimate","hmC.SE","hmC.t","hmC.P","mC.Estimate","mC.SE","mC.t","mC.P","U.Estimate","U.SE","U.t","U.P","CHR","MAPINFO","UCSC_RefGene_Name","UCSC_RefGene_Group","Relation_to_UCSC_CpG_Island","Regulatory_Feature_Group")
mC.p.ranked<-DRN.RESULTS.ANNOT[order(DRN.RESULTS.ANNOT[,9]),]
write.csv(mC.p.ranked[1:100,col], file="top100.mC.DRN.csv")


col<-c("hmC.Estimate","hmC.SE","hmC.t","hmC.P","mC.Estimate","mC.SE","mC.t","mC.P","U.Estimate","U.SE","U.t","U.P","CHR","MAPINFO","UCSC_RefGene_Name","UCSC_RefGene_Group","Relation_to_UCSC_CpG_Island","Regulatory_Feature_Group")
C.p.ranked<-DRN.RESULTS.ANNOT[order(DRN.RESULTS.ANNOT[,15]),]
write.csv(C.p.ranked[1:100,col], file="top100.C.DRN.csv")

```


```{r Lambda , include=FALSE}
chisq <- qchisq(1-(DRN.RESULTS.ANNOT10[,4]),1)
lambda = median(chisq)/qchisq(0.5,1)
lambda#1.065208

chisq <- qchisq(1-(DRN.RESULTS.ANNOT[,9]),1)
lambda = median(chisq)/qchisq(0.5,1)
lambda#1.122397

chisq <- qchisq(1-(DRN.RESULTS.ANNOT[,15]),1)
lambda = median(chisq)/qchisq(0.5,1)
lambda#1.043112 

pdf("qqplots.DRN.pdf", width=10, height=4)
par(mfrow=c(1,3))
qq(mC.p.ranked[,9], main="mC", pch=".")
title(sub="lambda=1.12",cex.lab=0.75)
qq(hmC.p.ranked[,4], main="hmC", pch=".")
title(sub="lambda=1.06",cex.lab=0.75)
qq(C.p.ranked[,15], main="C", pch=".")
title(sub="lambda=1.04",cex.lab=0.75)
dev.off()

p.BH.hmC<-as.data.frame(p.adjust(hmC.p.ranked[,4], "BH"))
head(p.BH.hmC,10)
-log10(0.05/nrow(hmC.p.ranked))
-log10(0.05/nrow(mC.p.ranked))

-log10(0.05/nrow(C.p.ranked))

p.BH.mC<-as.data.frame(p.adjust(mC.p.ranked[,9], "BH"))
head(p.BH.mC,10)


p.BH.C<-as.data.frame(p.adjust(C.p.ranked[,15], "BH"))
head(p.BH.C,10)
```

```{r DMR , include=TRUE}
library(dplyr)
DRN.RESULTS.ANNOT$MAPINFO.1<-as.numeric(DRN.RESULTS.ANNOT$MAPINFO)
DRN.RESULTS.ANNOT$MAPINFO.1.1<-(DRN.RESULTS.ANNOT$MAPINFO.1)+1
dmr <- data.frame("chrom" = 	paste0("chr", as.numeric(as.character(DRN.RESULTS.ANNOT$CHR))), 
					        "start" = 	DRN.RESULTS.ANNOT[rownames(DRN.RESULTS.ANNOT), "MAPINFO.1"],
                  "end" 	= 	DRN.RESULTS.ANNOT[rownames(DRN.RESULTS.ANNOT), "MAPINFO.1.1"],
                  "pvalue" = 	DRN.RESULTS.ANNOT[,15])

colnames(dmr) <- c("chrom", "start", "end", "pvalue")
dmr.U.DRN<-dmr[order(dmr[,1],dmr[,2]),]
head(dmr.U.DRN)
setwd("/home/ehsan/")
write.table(dmr.U.DRN, file="DRN.U.DMR.txt",sep = "\t", row.names = FALSE,col.names = TRUE, quote = FALSE)


DRN.RESULTS.ANNOT$MAPINFO.1<-as.numeric(DRN.RESULTS.ANNOT$MAPINFO)
DRN.RESULTS.ANNOT$MAPINFO.1.1<-(DRN.RESULTS.ANNOT$MAPINFO.1)+1
dmr <- data.frame("chrom" = 	paste0("chr", as.numeric(as.character(DRN.RESULTS.ANNOT$CHR))), 
					        "start" = 	DRN.RESULTS.ANNOT[rownames(DRN.RESULTS.ANNOT), "MAPINFO.1"],
                  "end" 	= 	DRN.RESULTS.ANNOT[rownames(DRN.RESULTS.ANNOT), "MAPINFO.1.1"],
                  "pvalue" = 	DRN.RESULTS.ANNOT[,9])

colnames(dmr) <- c("chrom", "start", "end", "pvalue")
dmr.mC.DRN<-dmr[order(dmr[,1],dmr[,2]),]
setwd("/home/ehsan/")
write.table(dmr.mC.DRN, file="DRN.mC.DMR.txt",sep = "\t", row.names = FALSE,col.names = TRUE, quote = FALSE)

DRN.RESULTS.ANNOT10$MAPINFO.1<-as.numeric(DRN.RESULTS.ANNOT10$MAPINFO)
DRN.RESULTS.ANNOT10$MAPINFO.1.1<-(DRN.RESULTS.ANNOT10$MAPINFO.1)+1
dmr <- data.frame("chrom" = 	paste0("chr", as.numeric(as.character(DRN.RESULTS.ANNOT10$CHR))), 
					        "start" = 	DRN.RESULTS.ANNOT10[rownames(DRN.RESULTS.ANNOT10), "MAPINFO.1"],
                  "end" 	= 	DRN.RESULTS.ANNOT10[rownames(DRN.RESULTS.ANNOT10), "MAPINFO.1.1"],
                  "pvalue" = 	DRN.RESULTS.ANNOT10[,4])

colnames(dmr) <- c("chrom", "start", "end", "pvalue")
dmr.mC.DRN<-dmr[order(dmr[,1],dmr[,2]),]
setwd("/home/ehsan/")
write.table(dmr.mC.DRN, file="DRN.hmC.DMR.txt",sep = "\t", row.names = FALSE,col.names = TRUE, quote = FALSE)
```

comb-p pipeline -c 4 --dist 1000 --seed 0.01 --anno hg19 -p  out.DRN.U500 DRN.U.DMR.txt
comb-p pipeline -c 4 --dist 1000 --seed 0.01 --anno hg19 -p  out.DRN.mC500 DRN.mC.DMR.txt
comb-p pipeline -c 4 --dist 1000 --seed 0.01 --anno hg19 -p  out.DRN.hmC500 DRN.hmC.DMR.txt

```{r pressure, echo=TRUE}
#select deletion region
32063403	32064838

res.chr.6 <- DRN.RESULTS.ANNOT[which(DRN.RESULTS.ANNOT$CHR =="6"),]
dim(res.chr.6)
TNXB<-res.chr.6[(which(res.chr.6$MAPINFO > 32063403 & res.chr.6$MAPINFO < 32064838)),]
dim(TNXB)
TableResultsTNXB <- data.frame(rownames(TNXB),as.numeric(TNXB[,1]),
                                as.numeric(TNXB[,9]),
                                as.character(TNXB$CHR),
                                as.numeric(as.character(TNXB$MAPINFO)), 
                                rep("TNXB", times = 41))

colnames(TableResultsTNXB)<-c("CpGid","estimate","p-val","CHR","MAPINFO","Gene_Name")
allResult<-makeGRangesFromDataFrame(TableResultsTNXB,    #convert into a Grange object
                                    keep.extra.columns=FALSE,
                                    ignore.strand=TRUE,
                                    seqinfo=NULL,
                                    seqnames.field=c("CHR"),
                                    start.field=c("MAPINFO"),
                                    end.field=c("MAPINFO"),
                                    starts.in.df.are.0based=FALSE)
chr <- as.character(unique(seqnames(allResult)))
atrack <- AnnotationTrack(allResult, name = "CpG sites")
axTrack <- GenomeAxisTrack()
idxTrack <- IdeogramTrack(genome = "hg19", chromosome = chr)
knownGenes <- UcscTrack(genome = "hg19", 
                        chromosome = chr,
                        track = "UCSC Genes", 
                        from = 27143234 -1500 , 
                        to = 27143790 +100, 
                        trackType = "GeneRegionTrack",
                        rstarts = "exonStarts", 
                        rends = "exonEnds", 
                        gene = "name",
                        showId=TRUE, 
                        geneSymbol=TRUE, 
                        strand = "strand",
                        fill = "#8282d2", 
                        name = "UCSC Genes")


CPGtrack <- AnnotationTrack(CpGs, name = "CpG Island")
biomTrack <- BiomartGeneRegionTrack(genome = "hg19",chromosome = 7 , start = 27143234-100, end = 27143790 + 100 ,name = "ENSEMBL", 
                                    filter = list(with_ox_refseq_mrna = TRUE),col.line = NULL, col = NULL, stackHeight = 0.5, 
                                    collapseTranscripts ="meta", transcriptAnnotation = "symbol")

HOXA2.betas<-data.frame(betas.all[rownames(HOXA2),])
#all_Diff <- MeanSuicide-MeanCon
extra_info<-data.frame(TableResultsHOXA2$CHR,as.numeric(as.character(TableResultsHOXA2$MAPINFO))) # create extra information
colnames(extra_info)<-c("chr", "start")
extra_info$end<-as.numeric(extra_info$start)+10

colnames(extra_info)<-c("chr", "start", "end")
rownames(extra_info)<-rownames(HOXA2)
extra_info

HOXA2_results<-as.data.frame(cbind(HOXA2.betas,extra_info))

HOXA2_DMR<-makeGRangesFromDataFrame(HOXA2_results, #convert into a Grange object
                                     keep.extra.columns=TRUE,
                                     ignore.strand=TRUE,
                                     seqinfo=NULL,
                                     seqnames.field=c("chr"),
                                     start.field=c("start"),
                                     end.field=c("end"),
                                     starts.in.df.are.0based=FALSE)


pheno.all[226,9]="EuGEI"

dTrack <- DataTrack(HOXA2_DMR, 
                    genome = "hg19", 
                    name = "Betas",
                    groups = pheno.all$sampleinfo, 
                    type = c("boxplot","a","g"), 
                    col=c("red", "blue"), 
                    legend = TRUE, lwd=2)

pdf("HOXA2_DMR.pdf", height=5, width=7.5)
plotTracks(list(idxTrack,axTrack,CPGtrack,atrack,dTrack,biomTrack), from = 27143234 -100, to = 27143790 + 100,
           transcriptAnnotation="symbol", 
           stacking="squish",
           background.title="#40464C")
dev.off()
```



